define(["../core","../core/toType","../var/isFunction"],function(c,b,d){var a=function(e,k,m,l,g,o,n){var f=0,h=e.length,j=m==null;if(b(m)==="object"){g=true;for(f in m){a(e,k,f,m[f],true,o,n)}}else{if(l!==undefined){g=true;if(!d(l)){n=true}if(j){if(n){k.call(e,l);k=null}else{j=k;k=function(p,i,q){return j.call(c(p),q)}}}if(k){for(;f<h;f++){k(e[f],m,n?l:l.call(e[f],f,k(e[f],m)))}}}}if(g){return e}if(j){return k.call(e)}return h?k(e[0],m):o};return a});