define(["../core","../var/isFunction","./var/nonce","./var/rquery","../ajax"],function(j,i,l,g){var h=[],k=/(=)\?(?=&|$)|\?\?/;j.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=h.pop()||(j.expando+"_"+(l++));this[a]=true;return a}});j.ajaxPrefilter("json jsonp",function(d,n,c){var a,f,e,b=d.jsonp!==false&&(k.test(d.url)?"url":typeof d.data==="string"&&(d.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&k.test(d.data)&&"data");if(b||d.dataTypes[0]==="jsonp"){a=d.jsonpCallback=i(d.jsonpCallback)?d.jsonpCallback():d.jsonpCallback;if(b){d[b]=d[b].replace(k,"$1"+a)}else{if(d.jsonp!==false){d.url+=(g.test(d.url)?"&":"?")+d.jsonp+"="+a}}d.converters["script json"]=function(){if(!e){j.error(a+" was not called")}return e[0]};d.dataTypes[0]="json";f=window[a];window[a]=function(){e=arguments};c.always(function(){if(f===undefined){j(window).removeProp(a)}else{window[a]=f}if(d[a]){d.jsonpCallback=n.jsonpCallback;h.push(a)}if(e&&i(f)){f(e[0])}e=f=undefined});return"script"}})});